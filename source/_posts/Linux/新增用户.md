---
title: 新增用户
date: 2019-06-17 11:17:10
tags: Linux
category: Linux
keyword: Linux新增用户,useradd,groupadd,sudoer,visudo
---

# 概述
新增用户分为两种，一种是可以使用 SSH 进行登陆，一种用于软件服务，不可登陆操作。


# 可登录用户

## 1-安装 sudo

### Debian
```shell
apt-get install sudo -y
```

### CentOS
```shell
yum install sudo -y
```

### FreeBSD
```shell
cd /usr/ports/security/sudo/ && make install clean
```
或者
```shell
pkg install sudo
```

## 2-添加用户到 sudo

### Debain/CentOS/FreeBSD
```shell
adduser newUserName
```

## 3-添加用户到 wheel 用户组
用户处于 wheel 用户组即可使用 `su` 命令执行 root 命令， 在 debian 系列的 Linux 里面常常使用 `sudo`  用户组来代替。

### Debian
```shell
usermod -aG sudo newUserName
```

### CentOS/FreeBSD
```shell
usermod -aG wheel newUserName
```

## 4-验证

### 确保 `sudoers` 文件配置合理
使用 `visudo` 命令，确保下列配置存在
```shell
# debian
# Allow members of group sudo to execute any command
%sudo   ALL=(ALL:ALL) ALL

# CentOS
# Allow members of group sudo to execute any command
%wheel   ALL=(ALL:ALL) ALL
```

## 5-重启 ssh

#### Debian
```shell
/etc/init.d/sshd restart
```

#### CentOS 6
```shell
/etc/init.d/sshd restart
```

#### CentOS 7
```shell
systemctl restart sshd.service
```

#### FreeBSD
```shell
/etc/rc.d/sshd start
```

## 6-测试
```shell
sudo uptime
sudo whoami
sudo su -
sudo -i
sudo -S
```

# 不可登陆用户
```shell
sudo useradd -r -M -s /sbin/nologin username

-c<备注>：加上备注文字。备注文字会保存在passwd的备注栏位中；
-d<登入目录>：指定用户登入时的启始目录；
-D：变更预设值；
-e<有效期限>：指定帐号的有效期限；
-f<缓冲天数>：指定在密码过期后多少天即关闭该帐号；
-g<群组>：指定用户所属的群组；
-G<群组>：指定用户所属的附加群组；
-m：自动建立用户的登入目录；
-M：不要自动建立用户的登入目录；
-n：取消建立以用户名称为名的群组；
-r：建立系统帐号；
-s<shell>：指定用户登入后所使用的shell；
-u<uid>：指定用户id。
```


# 参考
[https://www.vultr.com/docs/how-to-use-sudo-on-debian-centos-and-freebsd](https://www.vultr.com/docs/how-to-use-sudo-on-debian-centos-and-freebsd)<br />[http://man.linuxde.net/useradd](http://man.linuxde.net/useradd)<br />[https://3mile.github.io/archives/118/](https://3mile.github.io/archives/118/)
