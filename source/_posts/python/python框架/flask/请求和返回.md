---
title: 请求和返回
date: 2019-06-16 01:10:53
tags: flask
category: python
---
# 概述
本章记录学习一下知识点

1. 应用和请求的上下文管理
1. 请求的调度
1. 请求对象的属性和方法


# 应用和请求上下文
一个web网站，通常是用户发送请求到服务器，服务器应用理解用户的请求，并作出回应。这里用户的请求，映射到Flask 就是 `request` 对象。因为不同的用户其请求也是不一样，但是好在Flask帮我们做了处理，我们可以像使用一个全局变量来使用 `request`  对象
```python
@app.route("/request")
def request_test():
    user_agent = request.headers.get("User-Agent")
    return user_agent
```
应用和请求都有上下文，应用的上下文针对的是这个APP而言，而请求上下文针对的是每个用户发过来的上下文

| 变量名 | 上下文 | 描述 |
| --- | --- | --- |
| current_app | Application | 表示当前应用实例 —> app |
| g | Application | 一个全局对象，可以用来临时存储每次处理请求时的数据，在每次请求来临都会被清除 |
| request | Request | 用户请求对象，包含了用户发送到服务器的内容 |
| session | Request | 用户的会话对象 |


# 请求的调度
当Flask接收到用户的请求，就会根据其url 进行寻找对应的视图处理函数。我们可以看到其对应管理的URL
```python
>>> app.url_map
Map([<Rule '/request' (GET, OPTIONS, HEAD) -> request_test>,
 <Rule '/home' (GET, OPTIONS, HEAD) -> home>,
 <Rule '/' (GET, OPTIONS, HEAD) -> index>,
 <Rule '/static/<filename>' (GET, OPTIONS, HEAD) -> static>,
 <Rule '/user/<name>' (GET, OPTIONS, HEAD) -> user_profile>])
```


# 请求对象的属性和方法
这里主要记录一下请求对象的一些主要的属性

| 属性或者方法 | 描述 |
| --- | --- |
| form | 一个字典，由表单数据组成 |
| args | 一个字典，由发送过来的参数组成 |
| values | 字典，结合了form和args 的值 |
| headers | HTTP 头信息 |
| files | 上传文件 |
| get_data() | 缓存的数据 |
| get_json() | 传入的json |
| blueprint | 蓝图的名字 |
| endpoint | 视图函数的名字 |
| method | 请求的方式，如get/post |
| scheme | http/https |
| is_secure() | 是否使用了https |
| host | 主机名 |
| path | 资源的路径 |
| query_string | 在url请求的参数 |
| full_path | 完整的资源路径 |
| url | 完整的url |
| base_url | 域名 |
| remote_addr | 客户端的ip地址 |
| environ | WSGI的环境变量 |
| cookies | cookies的值 |


# request 钩子函数

## before_request
在处理请求前，要执行的函数

## before_first_request
第一次请求进来的时候，要先处理的函数

## after_request
处理完请求要运行的函数

## tear_request
处理请求的时候，有时候会出现异常，无论是否出现异常，均执行这个函数


# Responses对象
记录返回对象的属性和方法

| 属性和方法 | 描述 |
| --- | --- |
| status_code | http状态码 |
| headers | response 头信息 |
| set_cookie() | 设置返回的cookie |
| delete_cookie() | 删除cookie |
| content_length | 返回的文本长度 |
| content_type | 文本类型 |
| set_data() | 设置返回的类型为字符或者bytes值 |
| get_data() | 取得返回的body |


# 两个方法

## redirect
跳转，使用 `redirect()` 函数


## abort
中断请求处理，使用 `abort()` 函数
